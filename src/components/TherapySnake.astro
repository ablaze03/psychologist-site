---
// Используем зелёный цвет из палитры сайта (aquaSoft)
const stroke = "#C7D7C9"; // aquaSoft - зелёный цвет сайта
const dot = "rgba(199, 215, 201, 0.6)"; // aquaSoft с прозрачностью для точек
const connectorColor = "rgba(199, 215, 201, 0.4)"; // Цвет линий-соединителей

// Координаты точек на змейке (синхронизированы с позициями шагов)
// viewBox: 0 0 1400 420
// Позиции шагов в процентах от контейнера: x: 12, 33, 56, 76, 55, 84
// Контейнер max-width: 1200px, но viewBox 1400px
// Переводим проценты в координаты viewBox: 12% от 1400 = 168
const points = [
  { x: 168, y: 190 },  // 01 - 12% x, top
  { x: 462, y: 190 },  // 02 - 33% x, top
  { x: 784, y: 190 },  // 03 - 56% x, top
  { x: 1064, y: 310 }, // 04 - 76% x, bottom
  { x: 770, y: 310 },  // 05 - 55% x, bottom
  { x: 1176, y: 310 }, // 06 - 84% x, bottom
];

// Координаты кружочков с номерами (синхронизированы с позициями шагов в ProcessPath.astro)
// Позиции шагов в процентах: x: 12, 33, 56, 76, 55, 84; y: 22, 20, 25, 55, 78, 66
// Контейнер max-width: 1200px, viewBox 1400px
// Для верхних шагов (side: "top"): кружочки выше точек на змейке
// Для нижних шагов (side: "bottom"): кружочки ниже точек на змейке
// Примерно: верхние кружочки на y=50-80, нижние на y=340-380
const badgePositions = [
  { x: 168, y: 60 },   // 01 - 12% x, top (кружочек выше точки на ~130px)
  { x: 462, y: 50 },   // 02 - 33% x, top (кружочек выше точки на ~140px)
  { x: 784, y: 70 },   // 03 - 56% x, top (кружочек выше точки на ~120px)
  { x: 1064, y: 360 }, // 04 - 76% x, bottom (кружочек ниже точки на ~50px)
  { x: 770, y: 380 },  // 05 - 55% x, bottom (кружочек ниже точки на ~70px)
  { x: 1176, y: 350 }, // 06 - 84% x, bottom (кружочек ниже точки на ~40px)
];
---

<svg viewBox="0 0 1400 420" xmlns="http://www.w3.org/2000/svg" class="snakeSvg" aria-label="Путь терапии">
  <defs>
    <marker id="arrow" markerWidth="14" markerHeight="14" refX="10" refY="7" orient="auto">
      <path d="M0,0 L14,7 L0,14 Z" fill={stroke} />
    </marker>
    <filter id="softShadow">
      <feGaussianBlur in="SourceAlpha" stdDeviation="2"/>
      <feOffset dx="0" dy="1" result="offsetblur"/>
      <feComponentTransfer>
        <feFuncA type="linear" slope="0.3"/>
      </feComponentTransfer>
      <feMerge>
        <feMergeNode/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>
  </defs>

  <!-- Идеально ровная змейка: поворот слева -->
  <!-- Верхняя линия (слева направо) -> плавный переход вниз слева -> нижняя линия (слева направо) -> финал -->
  <path
    d="
      M 100 190
      L 168 190
      L 462 190
      L 784 190
      C 800 190, 810 200, 810 220
      C 810 240, 800 250, 780 260
      C 760 270, 750 280, 750 300
      C 750 310, 760 310, 770 310
      L 1064 310
      L 1176 310
      L 1300 310
    "
    fill="none"
    stroke={stroke}
    stroke-width="6"
    stroke-linecap="round"
    stroke-linejoin="round"
    marker-end="url(#arrow)"
    class="snakePath"
    filter="url(#softShadow)"
  />

  <!-- Точки на линии точно в позициях шагов -->
  <g fill={dot} stroke={dot}>
    {points.map((p) => (
      <circle cx={p.x} cy={p.y} r="7"/>
    ))}
  </g>

  <!-- Линии-соединители от точек на змейке к кружочкам с номерами -->
  <g stroke={connectorColor} stroke-width="2" stroke-dasharray="4,4" fill="none" opacity="0.6">
    {points.map((p, i) => {
      const badge = badgePositions[i];
      return (
        <line x1={p.x} y1={p.y} x2={badge.x} y2={badge.y} />
      );
    })}
  </g>
</svg>

<style>
  .snakeSvg { 
    width: 100%; 
    height: auto; 
    display: block; 
  }
  .snakePath { 
    opacity: 0.95; 
  }
</style>
