---
import TherapySnake from './TherapySnake.astro';
import type { ContentData } from '../types';
import contentData from '../../content.json';

interface Props {
  process: ContentData['process'];
}

const { process } = Astro.props;
const content = contentData as ContentData;

// Создаём ссылку на Telegram с prefilled текстом
const telegramMessage = "Добрый день! Меня зовут [Имя]. Хочу записаться на онлайн встречу-знакомство (30 мин). Удобные интервалы (по Москве): … Тема запроса (по желанию): …";
const telegramLinkWithMessage = `https://t.me/Irina_Spva?text=${encodeURIComponent(telegramMessage)}`;

// Позиции шагов (x, y в процентах от контейнера, side: 'top' или 'bottom')
// Тексты согласно ТЗ
const steps = [
  { n: "01", title: "Осознание", text: "Хочу по-другому.", x: 12, y: 22, side: "top" },
  { n: "02", title: "Запись", text: "Пишете в Telegram — выбираем время.", x: 33, y: 20, side: "top" },
  { n: "03", title: "Встреча-знакомство (30 мин)", text: "Уточняем запрос и формат.", x: 56, y: 25, side: "top" },
  { n: "04", title: "Регулярные сессии", text: "1–2 раза в неделю, 50–60 минут.", x: 76, y: 55, side: "bottom" },
  { n: "05", title: "Между встречами (по желанию)", text: "Небольшие практики и наблюдения.", x: 55, y: 78, side: "bottom" },
  { n: "06", title: "Опора и изменения", text: "Новые способы реагировать и больше ясности.", x: 84, y: 66, side: "bottom" },
];
---

<section id="process" class="process">
  <div class="container-custom">
    <div class="processHead">
      <h2 class="processTitle">{process.title}</h2>
      <p class="processSubtitle">{process.subtitle}</p>
    </div>

    <div class="snakeWrap" aria-hidden="false">
      <TherapySnake />
      <div class="stepsLayer">
        {steps.map((s) => {
          const isStep2 = s.n === "02";
          return (
            <div class={`step ${s.side}`} style={`left:${s.x}%; top:${s.y}%;`}>
              <div class="badge">{s.n}</div>
              <div class="copy">
                <div class="t">{s.title}</div>
                <div class="d">
                  {isStep2 ? (
                    <>
                      Пишете в{' '}
                      <a 
                        href={telegramLinkWithMessage}
                        class="telegram-link"
                        target="_blank"
                      >
                        Telegram
                      </a>
                      {' '}— выбираем время.
                    </>
                  ) : (
                    s.text
                  )}
                </div>
              </div>
            </div>
          );
        })}
      </div>
    </div>

    <!-- мобайл-версия (без змейки) -->
    <div class="stepsMobile">
      {steps.map((s) => {
        const isStep2 = s.n === "02";
        return (
          <div class="mStep">
            <div class="badge">{s.n}</div>
            <div>
              <div class="t">{s.title}</div>
              <div class="d">
                {isStep2 ? (
                  <>
                    Пишете в{' '}
                    <a 
                      href={telegramLinkWithMessage}
                      class="telegram-link"
                      target="_blank"
                    >
                      Telegram
                    </a>
                    {' '}— выбираем время.
                  </>
                ) : (
                  s.text
                )}
              </div>
            </div>
          </div>
        );
      })}
    </div>
  </div>
  
  <style>
    .process { 
      padding: 64px 0; 
      background-color: white;
    }
    
    .processHead { 
      text-align: center; 
      margin-bottom: 28px; 
    }
    
    .processTitle { 
      margin: 0; 
      font-size: clamp(2.5rem, 4vw, 4rem);
      font-weight: 300;
      letter-spacing: -0.02em;
      line-height: 1.1;
      color: var(--color-ink);
    }
    
    .processSubtitle { 
      margin: 10px 0 0; 
      font-size: 1rem;
      color: rgba(17, 24, 39, 0.7);
    }

    .snakeWrap {
      position: relative;
      max-width: 1200px;
      margin: 28px auto 0;
    }

    .stepsLayer {
      position: absolute;
      inset: 0;
      pointer-events: none;
    }

    .step {
      position: absolute;
      display: flex;
      gap: 12px;
      align-items: flex-start;
      max-width: 280px;
      transform: translate(-10%, -20%);
      pointer-events: auto;
    }
    
    .step.bottom { 
      transform: translate(-10%, 10%); 
    }

    .badge {
      width: 44px;
      height: 44px;
      border-radius: 999px;
      border: 2px solid var(--color-aquaSoft);
      color: var(--color-ink);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 0.75rem;
      background: rgba(255, 255, 255, 0.9);
      flex-shrink: 0;
    }

    .step .copy {
      flex: 1;
    }

    .step .t { 
      font-weight: 600; 
      margin-top: 2px; 
      font-size: 0.875rem;
      color: var(--color-ink);
      line-height: 1.4;
    }
    
    .step .d { 
      opacity: 0.75; 
      margin-top: 6px; 
      line-height: 1.35; 
      font-size: 0.75rem;
      color: var(--color-ink);
    }
    
    .telegram-link {
      color: var(--color-aquaSoft);
      text-decoration: underline;
      text-decoration-color: var(--color-aquaSoft);
      text-underline-offset: 2px;
      transition: opacity 0.2s;
    }
    
    .telegram-link:hover {
      opacity: 0.7;
    }

    .stepsMobile { 
      display: none; 
      max-width: 720px; 
      margin: 24px auto 0; 
    }
    
    .mStep { 
      display: flex; 
      gap: 12px; 
      padding: 14px 0; 
      border-top: 1px solid rgba(15, 23, 42, 0.08); 
    }
    
    .mStep:first-child { 
      border-top: 0; 
    }
    
    .mStep .badge {
      width: 44px;
      height: 44px;
      border-radius: 999px;
      border: 2px solid var(--color-aquaSoft);
      color: var(--color-ink);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 0.75rem;
      background: white;
      flex-shrink: 0;
    }
    
    .mStep .t {
      font-weight: 600;
      font-size: 0.875rem;
      color: var(--color-ink);
      margin-bottom: 4px;
    }
    
    .mStep .d {
      opacity: 0.75;
      font-size: 0.75rem;
      color: var(--color-ink);
      line-height: 1.4;
    }

    @media (max-width: 900px) {
      .snakeWrap { 
        display: none; 
      }
      .stepsMobile { 
        display: block; 
      }
    }
  </style>
</section>
