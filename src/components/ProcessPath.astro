---
import type { ContentData } from '../types';
import contentData from '../../content.json';

interface Props {
  process: ContentData['process'];
}

const { process } = Astro.props;
const content = contentData as ContentData;

// Создаём ссылку на Telegram с prefilled текстом
const telegramMessage = content.contacts.messageTemplate;
const telegramLinkWithMessage = `https://t.me/Irina_Spva?text=${encodeURIComponent(telegramMessage)}`;

// 5 шагов: чередуем top/bottom (1-top, 2-bottom, 3-top, 4-bottom, 5-top)
const steps = process.steps.map((step, i) => ({
  ...step,
  side: i % 2 === 0 ? 'top' : 'bottom'
}));
---

<section id="process" class="therapy-timeline">
  <div class="container-custom">
    <div class="timeline-header">
      <h2 class="timeline-title">{process.title}</h2>
      <p class="timeline-subtitle">{process.subtitle}</p>
    </div>

    <!-- Grid-структура: кружки на линии + тексты сверху/снизу -->
    <div class="timeline-grid">
      <!-- Ряд 1: Верхние тексты (1, 3, 5) -->
      <div class="texts-row texts-top">
        {steps.map((step) => step.side === 'top' ? (
          <div class="text-cell">
            <div class="step-text">
              <div class="step-title" set:html={step.title.replace(/\n/g, '<br />')}></div>
              <div class="step-desc">
                {step.description}
              </div>
            </div>
          </div>
        ) : (
          <div class="text-cell text-empty"></div>
        ))}
      </div>

      <!-- Ряд 2: Линия и большие кружки с цифрами -->
      <div class="timeline-row">
        <div class="timeline-line"></div>
        {steps.map((step) => (
          <div class="timeline-badge">{step.number}</div>
        ))}
      </div>

      <!-- Ряд 3: Нижние тексты (2, 4) -->
      <div class="texts-row texts-bottom">
        {steps.map((step) => step.side === 'bottom' ? (
          <div class="text-cell">
            <div class="step-text">
              <div class="step-title" set:html={step.title.replace(/\n/g, '<br />')}></div>
              <div class="step-desc">
                {step.description}
              </div>
            </div>
          </div>
        ) : (
          <div class="text-cell text-empty"></div>
        ))}
      </div>
    </div>

    <!-- Мобильная версия -->
    <div class="timeline-mobile">
      {steps.map((step) => (
        <div class="mobile-step">
          <div class="timeline-badge">{step.number}</div>
          <div>
            <div class="step-title" set:html={step.title.replace(/\n/g, '<br />')}></div>
            <div class="step-desc">
              {step.description}
            </div>
          </div>
        </div>
      ))}
    </div>
  </div>
  
  <style>
    .therapy-timeline {
      padding: 64px 0;
      background-color: white;
    }
    
    .timeline-header {
      text-align: center;
      margin-bottom: 48px;
    }
    
    .timeline-title {
      margin: 0;
      font-size: clamp(2rem, 3vw, 3rem);
      font-weight: 300;
      letter-spacing: -0.02em;
      line-height: 1.1;
      color: var(--color-ink);
    }
    
    .timeline-subtitle {
      margin: 12px 0 0;
      font-size: 1rem;
      color: rgba(17, 24, 39, 0.7);
    }

    /* Grid-структура: 5 колонок */
    .timeline-grid {
      max-width: 1200px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 0;
      position: relative;
    }

    /* Ряды с текстами */
    .texts-row {
      grid-column: 1 / -1;
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 0;
    }

    .texts-top {
      margin-bottom: 20px;
    }

    .texts-bottom {
      margin-top: 20px;
    }

    /* Ячейка текста */
    .text-cell {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 0 12px;
    }

    .text-empty {
      /* Пустая ячейка для выравнивания */
    }

    /* Текст шага */
    .step-text {
      max-width: 200px;
      text-align: center;
      width: 100%;
    }

    .step-title {
      font-weight: 600;
      font-size: 0.875rem;
      color: var(--color-ink);
      margin: 0 auto 6px;
      line-height: 1.3;
      text-align: center;
    }

    .step-desc {
      font-size: 0.75rem;
      color: rgba(17, 24, 39, 0.7);
      line-height: 1.4;
      text-align: center;
      margin: 0 auto;
    }

    .telegram-link {
      color: #A8CBB7;
      text-decoration: underline;
      text-decoration-color: #A8CBB7;
      text-underline-offset: 2px;
      transition: opacity 0.2s;
    }

    .telegram-link:hover {
      opacity: 0.7;
    }

    /* Ряд с линией и большими кружками */
    .timeline-row {
      grid-column: 1 / -1;
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 0;
      position: relative;
      height: 60px;
      align-items: center;
      padding: 0 20px;
    }

    /* Горизонтальная линия */
    .timeline-line {
      position: absolute;
      left: 20px;
      right: 20px;
      top: 50%;
      transform: translateY(-50%);
      height: 10px;
      background-color: #A8CBB7;
      border-radius: 5px;
      z-index: 0;
    }

    /* Большие кружки с цифрами на линии */
    .timeline-badge {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      border: 2px solid #A8CBB7;
      background: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 1.125rem;
      color: var(--color-ink);
      justify-self: center;
      position: relative;
      z-index: 1;
    }

    /* Мобильная версия */
    .timeline-mobile {
      display: none;
    }

    @media (max-width: 900px) {
      .timeline-grid {
        display: none;
      }

      .timeline-mobile {
        display: flex;
        flex-direction: column;
        gap: 20px;
        max-width: 600px;
        margin: 0 auto;
      }

      .mobile-step {
        display: flex;
        gap: 16px;
        align-items: flex-start;
      }

      .mobile-step .step-text {
        max-width: none;
      }

      .mobile-step .step-title {
        font-size: 1rem;
        margin-bottom: 8px;
      }

      .mobile-step .step-desc {
        font-size: 0.875rem;
      }
    }
  </style>
</section>
