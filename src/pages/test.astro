---
import SimpleLayout from '../layouts/SimpleLayout.astro';
import { questions, answerLabels, timeframe } from '../screening/config/questions';

const title = '–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–Ω–∏–Ω–≥ | –ï–∫–∞—Ç–µ—Ä–∏–Ω–∞ –°–ø–∏—Ä–∏–¥–æ–Ω–æ–≤–∞';
const description = '–û—Ü–µ–Ω–∏—Ç–µ —Å–≤–æ—ë —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ. –û—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞ –≤–∞–ª–∏–¥–Ω—ã—Ö —à–∫–∞–ª–∞—Ö PHQ-9 –∏ GAD-7.';
---

<SimpleLayout title={title} description={description}>
  <main class="screening">
    <!-- Welcome Screen -->
    <div id="screen-welcome" class="screen active">
      <div class="container">
        <h1>–ú–∏–Ω–∏ —á–µ–∫-–∞–ø —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è</h1>
        <p class="lead">–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å–∫—Ä–∏–Ω–∏–Ω–≥-—Ç–µ—Å—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–ª–∏–Ω–∏—á–µ—Å–∫–∏—Ö —à–∫–∞–ª PHQ-9 –∏ GAD-7</p>
        
        <div class="info-card">
          <div class="info-icon">‚ÑπÔ∏è</div>
          <div>
            <h3>–ß—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ?</h3>
            <p>–¢–µ—Å—Ç –ø–æ–º–æ–∂–µ—Ç –æ—Ü–µ–Ω–∏—Ç—å –≤—ã—Ä–∞–∂–µ–Ω–Ω–æ—Å—Ç—å –¥–µ–ø—Ä–µ—Å—Å–∏–≤–Ω—ã—Ö –∏ —Ç—Ä–µ–≤–æ–∂–Ω—ã—Ö —Å–∏–º–ø—Ç–æ–º–æ–≤ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 2 –Ω–µ–¥–µ–ª–∏.</p>
            <ul>
              <li>17 –≤–æ–ø—Ä–æ—Å–æ–≤, ~5 –º–∏–Ω—É—Ç</li>
              <li>–û—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞ —à–∫–∞–ª–∞—Ö PHQ-9 –∏ GAD-7</li>
              <li>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏</li>
            </ul>
          </div>
        </div>

        <div class="disclaimer">
          <strong>‚ö†Ô∏è –í–∞–∂–Ω–æ:</strong>
          <ul>
            <li>–≠—Ç–æ –ù–ï –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</li>
            <li>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–º–æ–≥–∞—é—Ç —Å–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –∏ —Å—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å</li>
            <li>–ü—Ä–∏ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã—Ö —Å–∏–º–ø—Ç–æ–º–∞—Ö —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞</li>
            <li>–î–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã –∏ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ</li>
          </ul>
        </div>

        <button class="btn-primary btn-large" id="btn-start">–ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç</button>

        <div id="resume-block" class="resume-card" style="display: none;">
          <p>–£ –≤–∞—Å –µ—Å—Ç—å –Ω–µ–∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–π —Ç–µ—Å—Ç</p>
          <div class="resume-buttons">
            <button class="btn-secondary" id="btn-resume">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
            <button class="btn-text" id="btn-new">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Questions Screen -->
    <div id="screen-questions" class="screen">
      <div class="container">
        <div class="progress-container">
          <div class="progress-bar">
            <div class="progress-fill" id="progress"></div>
          </div>
          <div class="progress-text" id="progress-text">–í–æ–ø—Ä–æ—Å 1 –∏–∑ 17</div>
        </div>

        <div class="timeframe">{timeframe}</div>
        
        <h2 id="question-text" class="question-title">–ó–∞–≥—Ä—É–∑–∫–∞...</h2>
        
        <div class="answers" id="answers"></div>

        <div class="nav">
          <button class="btn-secondary" id="btn-prev" disabled>‚Üê –ù–∞–∑–∞–¥</button>
          <button class="btn-primary" id="btn-next" disabled>–î–∞–ª–µ–µ ‚Üí</button>
        </div>

        <p class="help-text">–û—Ç–≤–µ—á–∞–π—Ç–µ –∏—Å—Ö–æ–¥—è –∏–∑ —Ç–æ–≥–æ, –∫–∞–∫ –≤—ã —Å–µ–±—è —á—É–≤—Å—Ç–≤–æ–≤–∞–ª–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 2 –Ω–µ–¥–µ–ª–∏</p>
      </div>
    </div>

    <!-- Safety Screen -->
    <div id="screen-safety" class="screen">
      <div class="container">
        <div class="safety-card">
          <div class="safety-icon">ü§ù</div>
          <h2>–í—ã –Ω–µ –æ–¥–Ω–∏</h2>
          <p class="lead">–¢–æ, —á—Ç–æ –≤—ã –∏—Å–ø—ã—Ç—ã–≤–∞–µ—Ç–µ ‚Äî —ç—Ç–æ —Å–∏–≥–Ω–∞–ª –æ —Ç–æ–º, —á—Ç–æ —Å–µ–π—á–∞—Å –Ω—É–∂–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞.</p>
          
          <div class="safety-content">
            <p>–ú—ã—Å–ª–∏ –æ –Ω–µ–∂–µ–ª–∞–Ω–∏–∏ –∂–∏—Ç—å –º–æ–≥—É—Ç –≤–æ–∑–Ω–∏–∫–∞—Ç—å –ø—Ä–∏ —Å–∏–ª—å–Ω–æ–º —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–º –∏—Å—Ç–æ—â–µ–Ω–∏–∏. <strong>–≠—Ç–æ –Ω–µ —Å–ª–∞–±–æ—Å—Ç—å</strong> ‚Äî —ç—Ç–æ –ø—Ä–∏–∑–Ω–∞–∫ —Ç–æ–≥–æ, —á—Ç–æ –Ω–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–µ–≤—ã—Å–∏–ª–∞ —Ä–µ—Å—É—Ä—Å—ã.</p>
            
            <div class="safety-actions">
              <h3>–ß—Ç–æ –≤–∞–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —Å–µ–π—á–∞—Å:</h3>
              <ul>
                <li><strong>–ü–æ–≥–æ–≤–æ—Ä–∏—Ç–µ —Å –±–ª–∏–∑–∫–∏–º —á–µ–ª–æ–≤–µ–∫–æ–º</strong> –æ —Ç–æ–º, —á—Ç–æ —á—É–≤—Å—Ç–≤—É–µ—Ç–µ</li>
                <li><strong>–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –ø—Å–∏—Ö–æ–ª–æ–≥—É –∏–ª–∏ –ø—Å–∏—Ö–æ—Ç–µ—Ä–∞–ø–µ–≤—Ç—É</strong> –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è</li>
                <li><strong>–ü—Ä–∏ –æ—Å—Ç—Ä—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏—è—Ö:</strong> –ø–æ–∑–≤–æ–Ω–∏—Ç–µ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É —ç–∫—Å—Ç—Ä–µ–Ω–Ω–æ–π –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–π –ø–æ–º–æ—â–∏</li>
              </ul>
            </div>

            <div class="emergency-contacts">
              <h4>–≠–∫—Å—Ç—Ä–µ–Ω–Ω–∞—è –ø–æ–º–æ—â—å 24/7:</h4>
              <ul>
                <li><strong>–≠–∫—Å—Ç—Ä–µ–Ω–Ω–∞—è –ø–æ–º–æ—â—å:</strong> <a href="tel:+7495051">+7 495 051</a></li>
                <li><strong>–ù–µ–æ—Ç–ª–æ–∂–Ω–∞—è –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –ø–æ–º–æ—â—å:</strong> <a href="tel:+74997912050">+7 499 791 20 50</a></li>
                <li><strong>–≠–∫—Å—Ç—Ä–µ–Ω–Ω–∞—è –º–µ–¥–∏–∫–æ-–ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –ø–æ–º–æ—â—å (–î–µ–ø–∑–¥—Ä–∞–≤ –ú–æ—Å–∫–≤—ã):</strong> <a href="tel:+74959895050">+7 495 989 50 50</a> (<a href="https://mosgorzdrav.ru" target="_blank">mosgorzdrav.ru</a>)</li>
                <li><strong>–ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –ø–æ–º–æ—â—å –ú–ß–° –†–æ—Å—Å–∏–∏:</strong> <a href="https://psi.mchs.gov.ru" target="_blank">psi.mchs.gov.ru</a></li>
              </ul>
            </div>
          </div>

          <div class="safety-buttons">
            <a href="https://t.me/spiridonova_psy" class="btn-primary" target="_blank">–ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é</a>
            <button class="btn-secondary" id="btn-safety-continue">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Results Screen -->
    <div id="screen-results" class="screen">
      <div class="container">
        <h2>–í–∞—à–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</h2>
        <p class="subtitle">–ö–∞—Ä—Ç–∞ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 2 –Ω–µ–¥–µ–ª–∏</p>

        <!-- –ì—Ä–∞—Ñ–∏–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ -->
        <div class="results-chart" id="results-chart"></div>

        <!-- –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è -->
        <div id="interpretation-block"></div>

        <!-- Evidence note -->
        <div class="evidence-note">
          <p><strong>–ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è:</strong> –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—Å–Ω–æ–≤–∞–Ω—ã –Ω–∞ –∫–ª–∏–Ω–∏—á–µ—Å–∫–∏—Ö —à–∫–∞–ª–∞—Ö PHQ-9 (Patient Health Questionnaire) –∏ GAD-7 (Generalized Anxiety Disorder). –≠—Ç–æ –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Å–∫—Ä–∏–Ω–∏–Ω–≥–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –≤ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–π –ø—Ä–∞–∫—Ç–∏–∫–µ.</p>
          <p><strong>–í–∞–∂–Ω–æ:</strong> –≠—Ç–æ –Ω–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –≤—ã—Ä–∞–∂–µ–Ω–Ω–æ—Å—Ç—å —Å–∏–º–ø—Ç–æ–º–æ–≤ –∏ –ø–æ–º–æ–≥–∞—é—Ç —Å—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å –¥–ª—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏.</p>
        </div>

        <!-- –õ–∏–¥-—Ñ–æ—Ä–º–∞ -->
        <div class="lead-card">
          <h3>üì© –ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</h3>
          <p style="margin-bottom: 1.5rem;">
            –û—Å—Ç–∞–≤—å—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç –¥–ª—è —Å–≤—è–∑–∏ –∏ –ø–æ–ª—É—á–∏—Ç–µ <strong>–¥–µ—Ç–∞–ª—å–Ω—É—é —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫—É –ø—Ä—è–º–æ –∑–¥–µ—Å—å</strong>
          </p>
          
          <form id="lead-form">
            <div class="contact-method">
              <label class="method-label">–ö—É–¥–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã?</label>
              <div class="method-options">
                <label class="method-option">
                  <input type="radio" name="contact_type" value="email" checked />
                  <span>Email</span>
                </label>
                <label class="method-option">
                  <input type="radio" name="contact_type" value="telegram" />
                  <span>Telegram</span>
                </label>
              </div>
            </div>

            <div id="contact-input-wrapper">
              <input type="email" id="contact_value" placeholder="–í–∞—à Email" required />
            </div>

            <div class="consent">
              <input type="checkbox" id="consent" name="consent" value="yes" required />
              <label for="consent">–°–æ–≥–ª–∞—Å–µ–Ω(–∞) –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–∞–Ω–Ω—ã—Ö</label>
            </div>
            <button type="submit" class="btn-primary btn-large">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –º–Ω–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</button>
          </form>

          <div id="form-success" class="success-message" style="display: none;">
            <div class="success-icon">‚úì</div>
            <h4>–ì–æ—Ç–æ–≤–æ!</h4>
            <p id="success-message-text">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã!</p>
            <div id="telegram-bot-link" style="display: none; margin-top: 1.5rem;">
              <a href="#" id="bot-link-button" target="_blank" class="btn-primary">
                üì± –ü–æ–ª—É—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ Telegram
              </a>
              <p style="margin-top: 1rem; font-size: 0.875rem; color: var(--text-light);">
                –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –∏ –Ω–∞–ø–∏—à–∏—Ç–µ –±–æ—Ç—É /start, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
              </p>
            </div>
          </div>
        </div>

        <!-- CTA -->
        <div class="cta-buttons" id="cta-booking-block">
          <a href="https://t.me/Irina_Spva" class="btn-primary" target="_blank" id="btn-booking">–ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é</a>
          <button class="btn-secondary" id="btn-restart">–ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç –∑–∞–Ω–æ–≤–æ</button>
        </div>
      </div>
    </div>
  </main>
</SimpleLayout>

<style is:global>
  /* ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Ç–∏–ª–∏ ... */
  .contact-method {
    margin-bottom: 1.5rem;
    text-align: left;
  }
  .method-label {
    display: block;
    font-weight: 600;
    margin-bottom: 0.75rem;
    color: var(--text);
  }
  .method-options {
    display: flex;
    gap: 1.5rem;
  }
  .method-option {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
  }
  .method-option input {
    width: 18px;
    height: 18px;
    accent-color: var(--primary);
  }
  #contact-input-wrapper input {
    width: 100%;
    padding: 1rem;
    border: 2px solid var(--border);
    border-radius: 12px;
    font-size: 1rem;
    margin-bottom: 1rem;
  }
  #contact-input-wrapper input:focus {
    outline: none;
    border-color: var(--primary);
  }
  /* ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Ç–∏–ª–∏ ... */
</style>

<style is:global>
  :root {
    --primary: #7c3aed;
    --primary-hover: #6d28d9;
    --text: #1f2937;
    --text-light: #6b7280;
    --bg: #ffffff;
    --bg-light: #f9fafb;
    --border: #e5e7eb;
    --success: #10b981;
    --warning: #f59e0b;
    --danger: #ef4444;
  }

  .screening {
    min-height: 100vh;
    padding: 2rem 1rem;
    background: 
      radial-gradient(circle at 20% 30%, rgba(167, 139, 250, 0.08) 0%, transparent 50%),
      radial-gradient(circle at 80% 70%, rgba(124, 58, 237, 0.06) 0%, transparent 50%),
      linear-gradient(135deg, #fafafa 0%, #ffffff 100%);
    background-attachment: fixed;
  }

  .container {
    max-width: 800px;
    margin: 0 auto;
  }

  .screen {
    display: none;
  }

  .screen.active {
    display: block;
    animation: fadeIn 0.4s ease;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .screening h1 {
    font-size: 2.5rem;
    font-weight: 800;
    color: var(--text);
    margin-bottom: 1rem;
    line-height: 1.15;
    letter-spacing: -0.02em;
    background: linear-gradient(135deg, var(--text), #4b5563);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .screening h2 {
    font-size: 2rem;
    font-weight: 700;
    color: var(--text);
    margin-bottom: 1rem;
    line-height: 1.3;
    letter-spacing: -0.01em;
  }

  .screening h3 {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--text);
    margin-bottom: 0.75rem;
    line-height: 1.4;
  }

  .lead {
    font-size: 1.25rem;
    color: var(--text-light);
    margin-bottom: 2rem;
  }

  .subtitle {
    font-size: 1.125rem;
    color: var(--text-light);
    margin-bottom: 2rem;
  }

  /* Info Card */
  .info-card {
    background: white;
    border: 2px solid var(--border);
    border-radius: 20px;
    padding: 2rem;
    margin-bottom: 2rem;
    display: flex;
    gap: 1.5rem;
    box-shadow: 0 2px 16px rgba(0, 0, 0, 0.04);
    transition: all 0.3s;
  }

  .info-card:hover {
    box-shadow: 0 4px 24px rgba(0, 0, 0, 0.08);
  }

  .info-icon {
    font-size: 3rem;
    flex-shrink: 0;
  }

  .info-card > div {
    text-align: left;
  }

  .info-card h3 {
    text-align: left;
  }

  .info-card p {
    text-align: left;
  }

  .info-card ul {
    margin-top: 0.75rem;
    padding-left: 0;
    color: var(--text-light);
    text-align: left;
    list-style: none;
  }

  .info-card li {
    margin-bottom: 0.5rem;
    text-align: left;
    padding-left: 0;
  }

  .info-card li::before {
    content: "‚Ä¢";
    color: var(--primary);
    font-weight: bold;
    display: inline-block;
    width: 1em;
    margin-right: 0.5rem;
  }

  /* Disclaimer */
  .disclaimer {
    background: #fef3c7;
    border: 2px solid #fbbf24;
    border-radius: 12px;
    padding: 1.5rem;
    margin-bottom: 2rem;
  }

  .disclaimer strong {
    display: block;
    margin-bottom: 0.75rem;
    color: #92400e;
  }

  .disclaimer ul {
    margin: 0;
    padding-left: 1.5rem;
  }

  .disclaimer li {
    margin-bottom: 0.5rem;
    color: #78350f;
  }

  /* Resume Card */
  .resume-card {
    background: #f0fdf4;
    border: 2px solid #86efac;
    border-radius: 12px;
    padding: 1.5rem;
    margin-top: 1.5rem;
    text-align: center;
  }

  .resume-buttons {
    display: flex;
    gap: 1rem;
    justify-content: center;
    margin-top: 1rem;
  }

  /* Buttons */
  .btn-primary {
    background: linear-gradient(135deg, var(--primary), #8b5cf6);
    color: white;
    border: none;
    border-radius: 14px;
    padding: 1rem 2rem;
    font-size: 1.125rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    text-decoration: none;
    display: inline-block;
    position: relative;
    overflow: hidden;
    box-shadow: 0 4px 16px rgba(124, 58, 237, 0.2);
  }

  .btn-primary::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transform: translateX(-100%);
    transition: transform 0.6s;
  }

  .btn-primary:hover:not(:disabled)::before {
    transform: translateX(100%);
  }

  .btn-primary:hover:not(:disabled) {
    background: linear-gradient(135deg, #6d28d9, #7c3aed);
    transform: translateY(-3px);
    box-shadow: 0 8px 24px rgba(124, 58, 237, 0.4);
  }

  .btn-primary:active:not(:disabled) {
    transform: translateY(-1px);
  }

  .btn-primary:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  .btn-large {
    width: 100%;
    max-width: 400px;
    font-size: 1.25rem;
    padding: 1.25rem 2rem;
  }

  .btn-secondary {
    background: white;
    color: var(--text);
    border: 2px solid var(--border);
    border-radius: 14px;
    padding: 1rem 2rem;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
  }

  .btn-secondary:hover:not(:disabled) {
    border-color: var(--primary);
    background: #f5f3ff;
    transform: translateY(-2px);
    box-shadow: 0 4px 16px rgba(124, 58, 237, 0.1);
  }

  .btn-secondary:active:not(:disabled) {
    transform: translateY(0);
  }

  .btn-secondary:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  .btn-text {
    background: none;
    border: none;
    color: var(--text-light);
    text-decoration: underline;
    cursor: pointer;
    padding: 0.5rem 1rem;
  }

  .btn-text:hover {
    color: var(--text);
  }

  /* Progress */
  .progress-container {
    margin-bottom: 2rem;
    background: white;
    padding: 1.25rem;
    border-radius: 16px;
    box-shadow: 0 2px 12px rgba(0, 0, 0, 0.04);
  }

  .progress-bar {
    height: 10px;
    background: linear-gradient(90deg, #f3f4f6, #e5e7eb);
    border-radius: 999px;
    overflow: hidden;
    margin-bottom: 0.75rem;
    position: relative;
  }

  .progress-bar::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
    animation: shimmer 2s infinite;
  }

  @keyframes shimmer {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
  }

  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #7c3aed, #a78bfa, #c4b5fd);
    background-size: 200% 100%;
    animation: gradientMove 3s ease infinite;
    transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    width: 0%;
    border-radius: 999px;
    box-shadow: 0 0 12px rgba(124, 58, 237, 0.4);
  }

  @keyframes gradientMove {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
  }

  .progress-text {
    text-align: center;
    font-size: 0.9375rem;
    font-weight: 600;
    color: var(--primary);
  }

  .timeframe {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    background: linear-gradient(135deg, #fef3c7, #fef08a);
    padding: 0.625rem 1.25rem;
    border-radius: 12px;
    font-size: 0.875rem;
    font-weight: 600;
    color: #92400e;
    margin-bottom: 1.5rem;
    border: 2px solid #fbbf24;
    box-shadow: 0 2px 8px rgba(251, 191, 36, 0.2);
  }

  .timeframe::before {
    content: '‚è±Ô∏è';
    font-size: 1.125rem;
  }

  .question-title {
    font-size: 1.875rem;
    font-weight: 700;
    color: var(--text);
    margin-bottom: 2rem;
    line-height: 1.35;
    letter-spacing: -0.01em;
  }

  /* Answers */
  .answers {
    display: grid;
    gap: 0.875rem;
    margin-bottom: 2rem;
  }

  .answer {
    background: white;
    border: 2px solid #e5e7eb;
    border-radius: 14px;
    padding: 1.125rem 1.5rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    cursor: pointer;
    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
  }

  .answer:hover:not(.selected) {
    border-color: #c4b5fd;
    background: #faf9fc;
    box-shadow: 0 2px 8px rgba(124, 58, 237, 0.08);
  }

  .answer.selected {
    background-color: #7c3aed !important; /* –¢–æ—Ç —Å–∞–º—ã–π —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π –∫–∞–∫ —É –∫–Ω–æ–ø–∫–∏ */
    border-color: #7c3aed !important;
    box-shadow: 0 4px 12px rgba(124, 58, 237, 0.3);
  }

  .radio {
    width: 22px;
    height: 22px;
    border: 2px solid #d1d5db;
    border-radius: 50%;
    position: relative;
    flex-shrink: 0;
    transition: all 0.2s;
    background: white;
  }

  .answer:hover:not(.selected) .radio {
    border-color: #a78bfa;
  }

  .answer.selected .radio {
    border-color: white !important;
    background: white !important;
  }

  .answer.selected .radio::after {
    content: '‚úì';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: #7c3aed !important;
    font-size: 14px;
    font-weight: 900;
    line-height: 1;
  }

  .answer-text {
    flex: 1;
    font-size: 1rem;
    line-height: 1.5;
    color: #1f2937;
    transition: all 0.2s;
  }

  .answer.selected .answer-text {
    font-weight: 700 !important;
    color: white !important; /* –ë–µ–ª—ã–π —Ç–µ–∫—Å—Ç –Ω–∞ —Ñ–∏–æ–ª–µ—Ç–æ–≤–æ–º —Ñ–æ–Ω–µ */
  }

  /* Navigation */
  .nav {
    display: flex;
    gap: 1rem;
    justify-content: space-between;
    margin-bottom: 1rem;
  }

  .help-text {
    text-align: center;
    font-size: 0.875rem;
    color: var(--text-light);
  }

  /* Safety Screen */
  .safety-card {
    background: white;
    border: 3px solid var(--primary);
    border-radius: 20px;
    padding: 3rem;
    text-align: center;
  }

  .safety-icon {
    font-size: 4rem;
    margin-bottom: 1.5rem;
  }

  .safety-content {
    text-align: left;
    margin: 2rem 0;
  }

  .safety-actions {
    background: var(--bg-light);
    border-radius: 12px;
    padding: 1.5rem;
    margin: 1.5rem 0;
  }

  .safety-actions ul {
    margin-top: 1rem;
    padding-left: 1.5rem;
  }

  .safety-actions li {
    margin-bottom: 0.75rem;
    line-height: 1.6;
  }

  .emergency-contacts {
    background: #fef3c7;
    border: 2px solid #fbbf24;
    border-radius: 12px;
    padding: 1.5rem;
  }

  .emergency-contacts h4 {
    margin-bottom: 1rem;
    color: #92400e;
  }

  .emergency-contacts ul {
    margin: 0;
    padding-left: 1.5rem;
  }

  .emergency-contacts li {
    margin-bottom: 0.75rem;
    color: #78350f;
  }

  .safety-buttons {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    margin-top: 2rem;
  }

  /* Results Chart */
  .results-chart {
    background: white;
    border: 2px solid var(--border);
    border-radius: 16px;
    padding: 2rem;
    margin-bottom: 2rem;
  }

  .chart-item {
    margin-bottom: 2rem;
  }

  .chart-item:last-child {
    margin-bottom: 0;
  }

  .chart-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.75rem;
  }

  .chart-label {
    font-weight: 600;
    color: var(--text);
  }

  .chart-value {
    font-weight: 700;
    font-size: 1.125rem;
  }

  .chart-bar {
    height: 12px;
    background: var(--bg-light);
    border-radius: 999px;
    overflow: hidden;
    margin-bottom: 0.5rem;
  }

  .chart-fill {
    height: 100%;
    border-radius: 999px;
    transition: width 0.6s ease;
  }

  .chart-level {
    font-size: 0.875rem;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  /* Interpretation Block */
  #interpretation-block {
    margin-bottom: 2rem;
  }

  .interpretation-card {
    background: white;
    border: 2px solid var(--border);
    border-radius: 16px;
    padding: 2rem;
    margin-bottom: 1.5rem;
  }

  .interpretation-card h3 {
    margin-bottom: 1rem;
  }

  .interpretation-card ul {
    padding-left: 1.5rem;
    margin-top: 1rem;
  }

  .interpretation-card li {
    margin-bottom: 0.75rem;
    line-height: 1.6;
  }

  /* Evidence Note */
  .evidence-note {
    background: var(--bg-light);
    border-radius: 12px;
    padding: 1.5rem;
    margin-bottom: 2rem;
    font-size: 0.9375rem;
    color: var(--text-light);
  }

  .evidence-note p {
    margin-bottom: 0.75rem;
  }

  .evidence-note p:last-child {
    margin-bottom: 0;
  }

  /* Lead Card */
  .lead-card {
    background: linear-gradient(135deg, #f5f3ff 0%, #ede9fe 100%);
    border: 2px solid var(--primary);
    border-radius: 16px;
    padding: 2rem;
    margin-bottom: 2rem;
  }

  .lead-card h3 {
    margin-bottom: 0.75rem;
  }

  #lead-form {
    margin-top: 1.5rem;
  }

  #lead-form input[type="email"] {
    width: 100%;
    padding: 1rem;
    border: 2px solid var(--border);
    border-radius: 12px;
    font-size: 1rem;
    margin-bottom: 1rem;
  }

  #lead-form input[type="email"]:focus {
    outline: none;
    border-color: var(--primary);
  }

  .consent {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    margin-bottom: 1.5rem;
  }

  .consent input[type="checkbox"] {
    margin-top: 0.25rem;
    width: 20px;
    height: 20px;
    cursor: pointer;
    accent-color: var(--primary);
  }

  .consent label {
    font-size: 0.9375rem;
    color: var(--text-light);
    cursor: pointer;
  }

  .success-message {
    text-align: center;
    padding: 2rem;
  }

  .success-icon {
    width: 60px;
    height: 60px;
    background: var(--success);
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    font-weight: bold;
    margin: 0 auto 1rem;
  }

  /* CTA Buttons */
  .cta-buttons {
    display: flex;
    gap: 1rem;
    justify-content: center;
    flex-wrap: wrap;
  }

  /* Mobile */
  @media (max-width: 768px) {
    .screening h1 {
      font-size: 2rem;
    }

    .screening h2 {
      font-size: 1.75rem;
    }

    .question-title {
      font-size: 1.5rem;
    }

    .info-card {
      flex-direction: column;
    }

    .nav {
      flex-direction: column-reverse;
    }

    .nav button {
      width: 100%;
    }

    .safety-card {
      padding: 2rem 1.5rem;
    }

    .safety-buttons {
      flex-direction: column;
    }

    .cta-buttons {
      flex-direction: column;
    }

    .cta-buttons a,
    .cta-buttons button {
      width: 100%;
    }
  }
</style>

<script>
  import { questions, answerLabels } from '../screening/config/questions';
  import { interpretations } from '../screening/config/interpretations';
  import { calculateResults, getLevelColor, getLevelLabel } from '../screening/lib/scoring';
  import { saveProgress, loadProgress, clearProgress, hasProgress } from '../screening/lib/storage';
  import type { TestResults } from '../screening/lib/scoring';

  // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–≤–æ–¥–∞ —É—Ä–æ–≤–Ω–µ–π –Ω–∞ —Ä—É—Å—Å–∫–∏–π –¥–ª—è Telegram
  function getLevelRu(level: string): string {
    const levels: Record<string, string> = {
      minimal: '–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π',
      mild: '–ª—ë–≥–∫–∏–π',
      moderate: '—É–º–µ—Ä–µ–Ω–Ω—ã–π',
      severe: '—Ç—è–∂—ë–ª—ã–π',
    };
    return levels[level] || level;
  }

  // State
  let currentQuestionIndex = 0;
  let answers: Record<string, number> = {};
  let results: TestResults | null = null;

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–π —Å–µ—Å—Å–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
  document.addEventListener('DOMContentLoaded', () => {
    if (hasProgress()) {
      const resumeBlock = document.getElementById('resume-block');
      if (resumeBlock) resumeBlock.style.display = 'block';
    }
  });

  // –ü–æ–∫–∞–∑–∞—Ç—å —ç–∫—Ä–∞–Ω
  function showScreen(screenId: string) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    const screen = document.getElementById(`screen-${screenId}`);
    if (screen) {
      screen.classList.add('active');
      window.scrollTo(0, 0);
    }
  }

  // –†–µ–Ω–¥–µ—Ä –≤–æ–ø—Ä–æ—Å–∞
  function renderQuestion() {
    const question = questions[currentQuestionIndex];
    const questionText = document.getElementById('question-text');
    const answersContainer = document.getElementById('answers');
    const progress = document.getElementById('progress');
    const progressText = document.getElementById('progress-text');
    const btnNext = document.getElementById('btn-next') as HTMLButtonElement;
    const btnPrev = document.getElementById('btn-prev') as HTMLButtonElement;

    if (questionText) questionText.textContent = question.text;

    const percent = Math.round(((currentQuestionIndex + 1) / questions.length) * 100);
    if (progress) progress.style.width = `${percent}%`;
    if (progressText) progressText.textContent = `–í–æ–ø—Ä–æ—Å ${currentQuestionIndex + 1} –∏–∑ ${questions.length}`;

    if (answersContainer) {
      answersContainer.innerHTML = answerLabels.map((label, value) => `
        <div class="answer ${answers[question.id] === value ? 'selected' : ''}" data-value="${value}">
          <div class="radio"></div>
          <div class="answer-text">${label}</div>
        </div>
      `).join('');

      answersContainer.querySelectorAll('.answer').forEach(el => {
        el.addEventListener('click', () => {
          const value = parseInt(el.getAttribute('data-value') || '0');
          answers[question.id] = value;
          renderQuestion();
          if (btnNext) btnNext.disabled = false;

          // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
          saveProgress({
            currentQuestion: currentQuestionIndex,
            answers,
            startedAt: Date.now(),
            lastUpdated: Date.now()
          });
        });
      });
    }

    if (btnNext) btnNext.disabled = answers[question.id] === undefined;
    if (btnPrev) btnPrev.disabled = currentQuestionIndex === 0;
  }

  // –°–ª–µ–¥—É—é—â–∏–π –≤–æ–ø—Ä–æ—Å
  function nextQuestion() {
    const question = questions[currentQuestionIndex];
    
    // –ï—Å–ª–∏ —ç—Ç–æ Safety –≤–æ–ø—Ä–æ—Å –∏ –æ—Ç–≤–µ—Ç > 0
    if (question.scale === 'SAFETY' && answers[question.id] > 0) {
      showScreen('safety');
      return;
    }

    if (currentQuestionIndex < questions.length - 1) {
      currentQuestionIndex++;
      renderQuestion();
    } else {
      showResults();
    }
  }

  // –ü—Ä–µ–¥—ã–¥—É—â–∏–π –≤–æ–ø—Ä–æ—Å
  function previousQuestion() {
    if (currentQuestionIndex > 0) {
      currentQuestionIndex--;
      renderQuestion();
    }
  }

  // –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
  function showResults() {
    results = calculateResults(answers);
    clearProgress(); // –û—á–∏—â–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å

    // –õ–æ–≥–∏–∫–∞ —Å–∫—Ä—ã—Ç–∏—è –∫–Ω–æ–ø–∫–∏ –∑–∞–ø–∏—Å–∏ –ø—Ä–∏ —Ç—è–∂–µ–ª—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏—è—Ö
    const bookingBtn = document.getElementById('btn-booking');
    const phq9Interp = interpretations.PHQ9[results.phq9.level];
    const gad7Interp = interpretations.GAD7[results.gad7.level];
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –º–æ–∂–Ω–æ –ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫–Ω–æ–ø–∫—É –∑–∞–ø–∏—Å–∏ (–æ–±–∞ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã —Ä–∞–∑—Ä–µ—à–∞—Ç—å)
    const showBooking = (phq9Interp.showBookingButton !== false) && (gad7Interp.showBookingButton !== false);
    
    if (bookingBtn) {
      if (showBooking) {
        bookingBtn.style.display = 'inline-block';
      } else {
        bookingBtn.style.display = 'none';
      }
    }

    // –†–µ–Ω–¥–µ—Ä–∏–º –≥—Ä–∞—Ñ–∏–∫
    const chartContainer = document.getElementById('results-chart');
    if (chartContainer) {
      chartContainer.innerHTML = `
        <h3 style="margin-bottom: 1.5rem;">–í—ã—Ä–∞–∂–µ–Ω–Ω–æ—Å—Ç—å —Å–∏–º–ø—Ç–æ–º–æ–≤</h3>
        ${[results.phq9, results.gad7].map(scale => `
          <div class="chart-item">
            <div class="chart-header">
              <span class="chart-label">${scale.label}</span>
              <span class="chart-value" style="color: ${getLevelColor(scale.level)}">${scale.score}/${scale.maxScore}</span>
            </div>
            <div class="chart-bar">
              <div class="chart-fill" style="width: ${scale.percent}%; background: ${getLevelColor(scale.level)}"></div>
            </div>
            <div class="chart-level" style="color: ${getLevelColor(scale.level)}">${getLevelLabel(scale.level)}</div>
          </div>
        `).join('')}
      `;
    }

    // –†–µ–Ω–¥–µ—Ä–∏–º –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—é
    const interpretationBlock = document.getElementById('interpretation-block');
    if (interpretationBlock) {
      let html = '';

      // PHQ-9 –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è
      html += `
        <div class="interpretation-card">
          <h3>${phq9Interp.title}</h3>
          <p>${phq9Interp.description}</p>
          
          ${phq9Interp.recommendations.length > 0 ? `
            <h4 style="margin-top: 1.5rem; margin-bottom: 0.75rem;">–ß—Ç–æ –º–æ–∂–µ—Ç –ø–æ–º–æ—á—å:</h4>
            <ul>
              ${phq9Interp.recommendations.map(r => `<li>${r}</li>`).join('')}
            </ul>
          ` : ''}
          
          ${phq9Interp.psychologistNote ? `
            <div style="margin-top: 1.5rem; padding: 1rem; background: #f3f4f6; border-left: 4px solid #9333ea; border-radius: 4px;">
              <p style="margin: 0; font-size: 0.95rem; color: #374151;">${phq9Interp.psychologistNote}</p>
            </div>
          ` : ''}
          
          ${phq9Interp.therapyQuestions.length > 0 ? `
            <h4 style="margin-top: 1.5rem; margin-bottom: 0.75rem;">–ß—Ç–æ –æ–±—Å—É–¥–∏—Ç—å —Å –ø—Å–∏—Ö–æ–ª–æ–≥–æ–º:</h4>
            <ul>
              ${phq9Interp.therapyQuestions.map(q => `<li>${q}</li>`).join('')}
            </ul>
          ` : ''}
        </div>
      `;

      // GAD-7 –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è
      html += `
        <div class="interpretation-card">
          <h3>${gad7Interp.title}</h3>
          <p>${gad7Interp.description}</p>
          
          ${gad7Interp.recommendations.length > 0 ? `
            <h4 style="margin-top: 1.5rem; margin-bottom: 0.75rem;">–ß—Ç–æ –º–æ–∂–µ—Ç –ø–æ–º–æ—á—å:</h4>
            <ul>
              ${gad7Interp.recommendations.map(r => `<li>${r}</li>`).join('')}
            </ul>
          ` : ''}
          
          ${gad7Interp.psychologistNote ? `
            <div style="margin-top: 1.5rem; padding: 1rem; background: #f3f4f6; border-left: 4px solid #9333ea; border-radius: 4px;">
              <p style="margin: 0; font-size: 0.95rem; color: #374151;">${gad7Interp.psychologistNote}</p>
            </div>
          ` : ''}
          
          ${gad7Interp.therapyQuestions.length > 0 ? `
            <h4 style="margin-top: 1.5rem; margin-bottom: 0.75rem;">–ß—Ç–æ –æ–±—Å—É–¥–∏—Ç—å —Å –ø—Å–∏—Ö–æ–ª–æ–≥–æ–º:</h4>
            <ul>
              ${gad7Interp.therapyQuestions.map(q => `<li>${q}</li>`).join('')}
            </ul>
          ` : ''}
        </div>
      `;

      // –ï—Å–ª–∏ –æ–±–∞ –≤—ã—Å–æ–∫–∏–µ
      if (results.phq9.level === 'severe' && results.gad7.level === 'severe') {
        const combinedInterp = interpretations.combined.bothHigh;
        html += `
          <div class="interpretation-card" style="background: #fef3c7; border-color: #fbbf24;">
            <h3>${combinedInterp.title}</h3>
            <p>${combinedInterp.description}</p>
            
            <h4 style="margin-top: 1.5rem; margin-bottom: 0.75rem;">–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</h4>
            <ul>
              ${combinedInterp.recommendations.map(r => `<li>${r}</li>`).join('')}
            </ul>
            
            ${combinedInterp.psychologistNote ? `
              <div style="margin-top: 1.5rem; padding: 1rem; background: #fef9f3; border-left: 4px solid #fb923c; border-radius: 4px;">
                <p style="margin: 0; font-size: 0.95rem; color: #7c2d12;">${combinedInterp.psychologistNote}</p>
              </div>
            ` : ''}
            
            ${combinedInterp.therapyQuestions.length > 0 ? `
              <h4 style="margin-top: 1.5rem; margin-bottom: 0.75rem;">–ß—Ç–æ –æ–±—Å—É–¥–∏—Ç—å —Å –ø—Å–∏—Ö–æ–ª–æ–≥–æ–º:</h4>
              <ul>
                ${combinedInterp.therapyQuestions.map(q => `<li>${q}</li>`).join('')}
              </ul>
            ` : ''}
          </div>
        `;
      }

      interpretationBlock.innerHTML = html;
    }

    showScreen('results');
  }

  // Event Listeners
  document.getElementById('btn-start')?.addEventListener('click', () => {
    showScreen('questions');
    renderQuestion();
  });

  document.getElementById('btn-resume')?.addEventListener('click', () => {
    const saved = loadProgress();
    if (saved) {
      currentQuestionIndex = saved.currentQuestion;
      answers = saved.answers;
      showScreen('questions');
      renderQuestion();
    }
  });

  document.getElementById('btn-new')?.addEventListener('click', () => {
    clearProgress();
    const resumeBlock = document.getElementById('resume-block');
    if (resumeBlock) resumeBlock.style.display = 'none';
  });

  document.getElementById('btn-next')?.addEventListener('click', nextQuestion);
  document.getElementById('btn-prev')?.addEventListener('click', previousQuestion);

  document.getElementById('btn-safety-continue')?.addEventListener('click', () => {
    // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –≤–æ–ø—Ä–æ—Å—É –∏–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º
    if (currentQuestionIndex < questions.length - 1) {
      currentQuestionIndex++;
      showScreen('questions');
      renderQuestion();
    } else {
      showResults();
    }
  });

  document.getElementById('btn-restart')?.addEventListener('click', () => {
    if (confirm('–ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç –∑–∞–Ω–æ–≤–æ? –¢–µ–∫—É—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—É–¥—É—Ç –ø–æ—Ç–µ—Ä—è–Ω—ã.')) {
      currentQuestionIndex = 0;
      answers = {};
      results = null;
      clearProgress();
      showScreen('welcome');
    }
  });

  // –õ–∏–¥-—Ñ–æ—Ä–º–∞
  const leadForm = document.getElementById('lead-form');
  const contactInput = document.getElementById('contact_value') as HTMLInputElement;
  const contactTypes = document.getElementsByName('contact_type');

  contactTypes.forEach(radio => {
    radio.addEventListener('change', (e) => {
      const type = (e.target as HTMLInputElement).value;
      if (type === 'email') {
        contactInput.type = 'email';
        contactInput.placeholder = '–í–∞—à Email';
      } else {
        contactInput.type = 'text';
        contactInput.placeholder = '@username –∏–ª–∏ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞';
      }
    });
  });

  leadForm?.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    console.log('üöÄ –§–æ—Ä–º–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!');
    console.log('üìä –¢–µ–∫—É—â–∏–µ results:', results);
    
    const consentCheckbox = document.getElementById('consent') as HTMLInputElement;
    const contactType = (document.querySelector('input[name="contact_type"]:checked') as HTMLInputElement)?.value;
    const contactValue = contactInput.value;

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    if (!results) {
      console.error('‚ùå –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã! –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º...');
      // –ü—ã—Ç–∞–µ–º—Å—è –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
      if (Object.keys(answers).length > 0) {
        results = calculateResults(answers);
        console.log('‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–µ—Ä–µ—Å—á–∏—Ç–∞–Ω—ã:', results);
      } else {
        alert('–û—à–∏–±–∫–∞: —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–π–¥–∏—Ç–µ —Ç–µ—Å—Ç –∑–∞–Ω–æ–≤–æ.');
        return;
      }
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–≥–ª–∞—Å–∏–µ
    if (!consentCheckbox.checked) {
      // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º —á–µ–∫–±–æ–∫—Å
      const consentDiv = consentCheckbox?.closest('.consent') as HTMLElement;
      if (consentDiv) {
        consentDiv.style.border = '2px solid #ef4444';
        consentDiv.style.padding = '0.75rem';
        consentDiv.style.borderRadius = '8px';
        consentDiv.style.backgroundColor = '#fee';
        setTimeout(() => {
          consentDiv.style.border = '';
          consentDiv.style.padding = '';
          consentDiv.style.borderRadius = '';
          consentDiv.style.backgroundColor = '';
        }, 3000);
      }
      return;
    }

    // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –Ω–∞ –≤—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏
    const submitButton = leadForm.querySelector('button[type="submit"]') as HTMLButtonElement;
    const originalText = submitButton.textContent;
    submitButton.disabled = true;
    submitButton.textContent = '–û—Ç–ø—Ä–∞–≤–∫–∞...';

    try {
      const TOKEN = '8201502833:AAFdAhwA5XNjmoVSICXTgEYwMFC3PoW2RT0';
      const PSYCHOLOGIST_CHAT_ID = '269044713'; // –í–∞—à Chat ID

      // 1. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –í–ê–ú (–ø—Å–∏—Ö–æ–ª–æ–≥—É) —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–æ–≤–æ–º –∫–ª–∏–µ–Ω—Ç–µ
      const messageToYou = `
üÜï <b>–ù–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∞</b>

üë§ <b>–ö–æ–Ω—Ç–∞–∫—Ç –∫–ª–∏–µ–Ω—Ç–∞:</b>
${contactType === 'email' ? 'üìß' : 'üì±'} ${contactValue}

üìä <b>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:</b>
üü¶ <b>–î–µ–ø—Ä–µ—Å—Å–∏—è (PHQ-9):</b> ${results?.phq9.score} –±–∞–ª–ª–æ–≤ ‚Äî ${getLevelRu(results?.phq9.level || 'minimal')}
üüß <b>–¢—Ä–µ–≤–æ–≥–∞ (GAD-7):</b> ${results?.gad7.score} –±–∞–ª–ª–æ–≤ ‚Äî ${getLevelRu(results?.gad7.level || 'minimal')}

${results?.safetyTriggered ? '‚ö†Ô∏è <b>–í–ù–ò–ú–ê–ù–ò–ï:</b> –°—Ä–∞–±–æ—Ç–∞–ª safety-—Ç—Ä–∏gg–µ—Ä (—Å—É–∏—Ü–∏–¥–∞–ª—å–Ω—ã–µ –º—ã—Å–ª–∏)\n' : ''}
${(results?.phq9.level === 'severe' || results?.gad7.level === 'severe') ? 'üî¥ <b>–¢—è–∂—ë–ª–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ</b> ‚Äî —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω –ø—Å–∏—Ö–æ—Ç–µ—Ä–∞–ø–µ–≤—Ç/–ø—Å–∏—Ö–∏–∞—Ç—Ä\n' : ''}

<i>–î–∞—Ç–∞: ${new Date().toLocaleString('ru-RU')}</i>
`;

      const responseToYou = await fetch(
        `https://api.telegram.org/bot${TOKEN}/sendMessage`,
        {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            chat_id: PSYCHOLOGIST_CHAT_ID,
            text: messageToYou,
            parse_mode: 'HTML',
          }),
        }
      );

      const resultToYou = await responseToYou.json();
      console.log('–û—Ç–ø—Ä–∞–≤–∫–∞ –ø—Å–∏—Ö–æ–ª–æ–≥—É:', resultToYou);

      // 2. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ö–õ–ò–ï–ù–¢–£
      let clientEmailSent = false;
      
      if (contactType === 'email' && contactValue) {
        // –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ EmailJS (–±–µ—Å–ø–ª–∞—Ç–Ω–æ 200 –ø–∏—Å–µ–º/–º–µ—Å—è—Ü)
        const EMAILJS_PUBLIC_KEY = 'kCMxayT38mW-reL5i';
        const EMAILJS_SERVICE_ID = 'service_v28ckmf';
        const EMAILJS_TEMPLATE_ID = 'template_xbr8x89';
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ª–∏ EmailJS
        if (EMAILJS_PUBLIC_KEY !== 'YOUR_PUBLIC_KEY') {
          try {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º EmailJS SDK
            if (!(window as any).emailjs) {
              const script = document.createElement('script');
              script.src = 'https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js';
              document.head.appendChild(script);
              await new Promise((resolve, reject) => {
                script.onload = resolve;
                script.onerror = reject;
                setTimeout(reject, 5000); // –¢–∞–π–º–∞—É—Ç 5 —Å–µ–∫
              });
              (window as any).emailjs.init(EMAILJS_PUBLIC_KEY);
            }
            
            const phq9Interp = interpretations.PHQ9[results?.phq9.level || 'minimal'];
            const gad7Interp = interpretations.GAD7[results?.gad7.level || 'minimal'];
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º email –∫–ª–∏–µ–Ω—Ç—É
            await (window as any).emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, {
              to_email: contactValue,
              to_name: '–£–≤–∞–∂–∞–µ–º—ã–π –∫–ª–∏–µ–Ω—Ç',
              phq9_score: results?.phq9.score,
              phq9_level: phq9Interp.title,
              phq9_description: phq9Interp.description,
              phq9_recommendations: '‚Ä¢ ' + phq9Interp.recommendations.join('\n‚Ä¢ '),
              gad7_score: results?.gad7.score,
              gad7_level: gad7Interp.title,
              gad7_description: gad7Interp.description,
              gad7_recommendations: '‚Ä¢ ' + gad7Interp.recommendations.join('\n‚Ä¢ '),
              psychologist_note: phq9Interp.psychologistNote || gad7Interp.psychologistNote || '',
              date: new Date().toLocaleDateString('ru-RU'),
            });
            
            clientEmailSent = true;
            console.log('‚úÖ Email –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –∫–ª–∏–µ–Ω—Ç—É:', contactValue);
          } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ email:', error);
          }
        } else {
          console.log('‚ö†Ô∏è EmailJS –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∫–ª—é—á–∏ –≤ test.astro');
        }
      }

      const sendResult = { ok: resultToYou.ok };
      console.log('–†–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏:', sendResult);

      if (sendResult.ok) {
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º success —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –î–õ–Ø –í–°–ï–•
        const form = document.getElementById('lead-form');
        const success = document.getElementById('form-success');
        const successText = document.getElementById('success-message-text');
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ü–†–Ø–ú–û –ù–ê –°–¢–†–ê–ù–ò–¶–ï –¥–ª—è –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
        const phq9Interp = interpretations.PHQ9[results?.phq9.level || 'minimal'];
        const gad7Interp = interpretations.GAD7[results?.gad7.level || 'minimal'];
        
        const detailedResults = `
          <div style="margin-top: 2rem; padding: 2rem; background: white; border-radius: 12px; border: 2px solid #7c3aed; text-align: left;">
            <h3 style="margin: 0 0 1.5rem 0; color: #7c3aed;">üìä –í–∞—à–∏ –¥–µ—Ç–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</h3>
            
            <div style="margin-bottom: 2rem; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
              <h4 style="margin: 0 0 0.5rem 0;">üü¶ –î–µ–ø—Ä–µ—Å—Å–∏—è (PHQ-9): ${results?.phq9.score} –±–∞–ª–ª–æ–≤</h4>
              <p style="margin: 0; font-weight: 600;">${phq9Interp.title}</p>
              <p style="margin: 0.5rem 0 0 0; font-size: 0.9rem;">${phq9Interp.description}</p>
              ${phq9Interp.recommendations.length > 0 ? `
                <div style="margin-top: 1rem;">
                  <strong>–ß—Ç–æ –º–æ–∂–µ—Ç –ø–æ–º–æ—á—å:</strong>
                  <ul style="margin: 0.5rem 0 0 0; padding-left: 1.5rem;">
                    ${phq9Interp.recommendations.map(r => `<li style="margin: 0.25rem 0;">${r}</li>`).join('')}
                  </ul>
                </div>
              ` : ''}
              ${phq9Interp.psychologistNote ? `
                <div style="margin-top: 1rem; padding: 0.75rem; background: #f3f4f6; border-left: 3px solid #9333ea; font-size: 0.9rem;">
                  üí¨ ${phq9Interp.psychologistNote}
                </div>
              ` : ''}
            </div>
            
            <div style="margin-bottom: 2rem; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
              <h4 style="margin: 0 0 0.5rem 0;">üüß –¢—Ä–µ–≤–æ–≥–∞ (GAD-7): ${results?.gad7.score} –±–∞–ª–ª–æ–≤</h4>
              <p style="margin: 0; font-weight: 600;">${gad7Interp.title}</p>
              <p style="margin: 0.5rem 0 0 0; font-size: 0.9rem;">${gad7Interp.description}</p>
              ${gad7Interp.recommendations.length > 0 ? `
                <div style="margin-top: 1rem;">
                  <strong>–ß—Ç–æ –º–æ–∂–µ—Ç –ø–æ–º–æ—á—å:</strong>
                  <ul style="margin: 0.5rem 0 0 0; padding-left: 1.5rem;">
                    ${gad7Interp.recommendations.map(r => `<li style="margin: 0.25rem 0;">${r}</li>`).join('')}
                  </ul>
                </div>
              ` : ''}
              ${gad7Interp.psychologistNote ? `
                <div style="margin-top: 1rem; padding: 0.75rem; background: #f3f4f6; border-left: 3px solid #9333ea; font-size: 0.9rem;">
                  üí¨ ${gad7Interp.psychologistNote}
                </div>
              ` : ''}
            </div>
            
            <div style="padding: 1rem; background: #d1fae5; border-radius: 8px; border-left: 4px solid #10b981;">
              <p style="margin: 0; font-size: 0.875rem;">
                üíæ <strong>–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:</strong> –°–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã, —á—Ç–æ–±—ã –Ω–µ –ø–æ—Ç–µ—Ä—è—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏.
              </p>
            </div>
          </div>
        `;
        
        if (successText) {
          successText.innerHTML = `‚úÖ <strong>–ì–æ—Ç–æ–≤–æ!</strong> –í–∞—à –∫–æ–Ω—Ç–∞–∫—Ç (${contactValue}) –ø–æ–ª—É—á–µ–Ω. –î–µ—Ç–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∏–∂–µ üëá` + detailedResults;
        }
        
        if (form) form.style.display = 'none';
        if (success) success.style.display = 'block';

        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–±—ã—Ç–∏–µ –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫—É
        if ((window as any).ym) {
          (window as any).ym(106211627, 'reachGoal', 'screening_lead_submit');
        }
      } else {
        // –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏
        console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:', sendResult);
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫—Ä–∞—Å–∏–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
        const errorMsg = document.createElement('div');
        errorMsg.style.cssText = 'position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #fee; border: 2px solid #ef4444; padding: 2rem; border-radius: 12px; z-index: 10000; max-width: 400px;';
        errorMsg.innerHTML = `
          <h3 style="color: #ef4444; margin: 0 0 1rem 0;">–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏</h3>
          <p style="margin: 0 0 1rem 0;">–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.</p>
          <p style="margin: 0 0 1.5rem 0; font-size: 0.875rem; color: #666;">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–≤—è–∂–∏—Ç–µ—Å—å —Å–æ –º–Ω–æ–π –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ –∫–æ–Ω—Ç–∞–∫—Ç—ã –Ω–∞ —Å–∞–π—Ç–µ.</p>
          <button onclick="this.parentElement.remove()" style="background: #7c3aed; color: white; border: none; padding: 0.5rem 1.5rem; border-radius: 8px; cursor: pointer; font-size: 1rem;">–ó–∞–∫—Ä—ã—Ç—å</button>
        `;
        document.body.appendChild(errorMsg);
      }
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:', error);
      alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–≤—è–∂–∏—Ç–µ—Å—å —Å–æ –º–Ω–æ–π –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ –∫–æ–Ω—Ç–∞–∫—Ç—ã –Ω–∞ —Å–∞–π—Ç–µ.');
    } finally {
      // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
      submitButton.disabled = false;
      submitButton.textContent = originalText;
    }
  });

  // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∫–ª–∏–∫–æ–≤ –ø–æ –∑–∞–ø–∏—Å–∏
  document.querySelectorAll('a[href*="t.me"]').forEach(link => {
    link.addEventListener('click', () => {
      if ((window as any).ym) {
        (window as any).ym(106211627, 'reachGoal', 'screening_booking_click');
      }
    });
  });
</script>
</SimpleLayout>
